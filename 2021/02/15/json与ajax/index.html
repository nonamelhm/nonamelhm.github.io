<!-- build time:Sat Apr 09 2022 18:42:14 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="越努力越幸运" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="越努力越幸运" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="越努力越幸运" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="JSON,XMLHTTPRequest,AJAX,跨域,Web Sockets"><link rel="canonical" href="http://example.com/2021/02/15/json%E4%B8%8Eajax/"><title>json与ajax - js | Seed's Blog = 越努力越幸运 = 好好学习，天天向上</title><meta name="generator" content="Hexo 6.1.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">json与ajax</h1><div class="meta"><span class="item" title="创建时间：2021-02-15 22:30:33"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-02-15T22:30:33+08:00">2021-02-15</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7.7k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Seed's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipewf5l51j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclwuom7cj20zk0m8dvn.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giph4lm9i7j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicli9lfebj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipev1x5e4j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicm0n457cj20zk0m8e81.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/js/" itemprop="item" rel="index" title="分类于 js"><span itemprop="name">js</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2021/02/15/json%E4%B8%8Eajax/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Seed"><meta itemprop="description" content="好好学习，天天向上, 学海无涯"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="越努力越幸运"></span><div class="body md" itemprop="articleBody"><h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2><p>本文根据高程中的二十、二十一章来写的，相当于个人的读书笔记。</p><h2 id="json-语法"><a class="anchor" href="#json-语法">#</a> JSON 语法</h2><p>JSON 不支持<strong>变量</strong>、<strong>函数</strong>、<strong>对象实例</strong>，它就是一种表示结构化数据的格式，JSON 语法可以表示以下三种类型的值：</p><ul><li>简单值：使用与 JavaScript 相同的语法，可以在 JSON 中表示字符串、数值、布尔值和 null，但是不支持 undefined</li><li>对象：表示一组无序的键值对</li><li>数组：表示一组有序的值的列表</li></ul><h3 id="简单值"><a class="anchor" href="#简单值">#</a> 简单值</h3><p>可以直接用简单值构成一个 JSON，例如直接写 &quot;hello world&quot;，JSON 字符串必须使用双引号 (单引号会导致语法错误)</p><h3 id="对象"><a class="anchor" href="#对象">#</a> 对象</h3><p>与 JS 的对象字面量相比，JSON 对象有两个差异之处，一是没有声明变量，二是没有末尾的分号；JOSN 还有与众不同的是最后一个属性后不能加多余逗号</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"tony"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">123</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="数组"><a class="anchor" href="#数组">#</a> 数组</h3><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token string">"hello world"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token null keyword">null</span><span class="token punctuation">]</span></pre></td></tr></table></figure><h2 id="json-解析与序列化"><a class="anchor" href="#json-解析与序列化">#</a> JSON 解析与序列化</h2><p>JSON 对象的两个方法：stringify () 和 parse ()，分别用于把 JS 对象序列化成 JSON 字符串和把 JSON 字符串解析为原生 JS 值，默认情况下，JSON.stringify () 输出的 JSON 字符串<strong>不包含任何空格字符或缩进</strong>，在序列化对象时，所有函数、原型成员和值为 undefined 都会被有意忽略，最终结果都是有效的 JSON 数据类型的实例属性</p><h3 id="序列化选项"><a class="anchor" href="#序列化选项">#</a> 序列化选项</h3><p>JSON.stringify () 除了要序列化 JS 对象之外，还可以接收两个参数，第一个参数是个过滤器，可以是数组，也可以是函数；第二个参数是一个选项，表示是否在 JSON 字符串中保留缩进，最大缩进空格数为 10，所有大于 10 的值都会自动转换为 10</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">"b"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token keyword">null</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只会返回 a 和 c 属性</span></pre></td></tr></table></figure><h3 id="tojson方法"><a class="anchor" href="#tojson方法">#</a> toJSON () 方法</h3><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">"b"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'a'</span></pre></td></tr></table></figure><p>假如把一个对象传入 JSON.stringify ()，序列化该对象的顺序如下：</p><ol><li>如果存在 toJOSN () 方法而且能通过它取得有效的值，则调用该方法</li><li>如果提供了第二个参数，应用这个函数过滤器，传入函数过滤器的值是第一步返回的值</li><li>对第二步返回的每个值进行相应的序列化，执行相应的序列化</li><li>如果提供了第三个参数，执行相应的格式化</li></ol><h3 id="解析选项"><a class="anchor" href="#解析选项">#</a> 解析选项</h3><p>JOSN.parse () 也可以接受另一个参数，该参数是一个函数，将在每个键值对调用</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">return</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="xmlhttprequestajax-技术的核心"><a class="anchor" href="#xmlhttprequestajax-技术的核心">#</a> XMLHTTPRequest (Ajax 技术的核心)</h2><p>直接使用 new 实例化该对象： <code>const xhr = new XMLHTTPRequest()</code></p><h3 id="xhr-的用法"><a class="anchor" href="#xhr-的用法">#</a> xhr 的用法</h3><p>在使用 XHR 对象时，调用的第一个方法是 open ()，它接收三个参数：要发送的请求类型 (get, post)，这一方法只是启动一个请求已备发送</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"api/test"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 发送特定的请求</span></pre></td></tr><tr><td data-num="4"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>send () 方法接收一个参数，即要作为请求主体发送的数据。如果不需要通过请求主体发送数据，则必须是 null。在收到相应后的数据会自动填充到 XHR 对象的属性，</p><ul><li>responseText: 作为响应主体被返回的文本</li><li>responseXML: 如果响应的内容类型是 text/xml 或 application/xml，这个属性中将保存包含着响应数据的 XML DOM 文档</li><li>status: 响应的 HTTP 状态</li><li>statusText: HTTP 状态的说明</li></ul><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Request was unsuccessful"</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在多数情况下我们需要发送的是异步请求，才能让 JS 继续执行而不必等待响应。此时，可以检测 XHR 对象的 readyState 属性，该属性表示请求 / 响应过程的当前活动阶段。这个可取的值如下：</p><ol><li>0: 未初始化。尚未调用 open () 方法</li><li>1: 启动。已经调用 open () 方法，但尚未调用 send () 方法</li><li>2: 发送。已经调用 send () 方法，但尚未收到响应</li><li>3: 接收。已经接收到部分响应数据</li><li>4: 完成。已经接收到全部响应数据，而且已经在客户端使用了</li></ol><p>只要 readyState 属性的值由一个值变成另一个值，都会触发一次 readystatechange 事件。必须在 open 调用之前指定 onreadystatechange 事件来保证跨浏览器兼容性</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHTTPRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Request was unsuccessful:"</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"api/test"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>在接收到响应之前还可以调用 abort () 方法来取消异步请求，调用这个方法后，XHR 对象会停止触发事件，而且也不再允许任何与响应有关的对象属性，在终止请求之后，还应该对 XHR 进行解引用操作。由于内存原因，<strong>不建议重用 XHR 对象</strong></p></blockquote><h3 id="http-头部信息"><a class="anchor" href="#http-头部信息">#</a> HTTP 头部信息</h3><p>在发送 XHR 请求的同时，还会发送下列头部信息：</p><ul><li>Accept: 浏览器能够处理的内容类型</li><li>Accept-Charset: 浏览器能够显示的字符集</li><li>Accept-Encoding: 浏览器能够处理的压缩编码</li><li>Accept-Language: 浏览器当前设置的语言</li><li>Connection: 浏览器与服务器之间连接的类型</li><li>Cookie: 当前页面设置的任何 Cookie</li><li>Host: 发出请求页面所在的域</li><li>Referer: 发出请求的页面 URI。注意 HTTP 规范对这个字段拼错了，实际是 referrer</li><li>User-Agent: 浏览器的用户代理字符串</li></ul><p>使用 setRequestHeader () 方法可以设置自定义的请求头部信息，但必须在调用 **open ()<strong> 方法之后</strong> send ()** 方法之前。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">"MyHeader"</span><span class="token punctuation">,</span> <span class="token string">"MyValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>调用 XHR 对象的 getResponseHeader () 方法并传入头部字段名称，可以取得相应的响应头部信息。而调用 getAllReponseHeaders () 方法可以取得一个包含所有头部信息的长字符串。</p><h3 id="get-请求"><a class="anchor" href="#get-请求">#</a> GET 请求</h3><p>下面这个函数可以辅助向现有 URL 的末尾添加查询字符串参数：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">addURLParam</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  url <span class="token operator">+=</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"?"</span> <span class="token operator">:</span> <span class="token string">"&amp;"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  url <span class="token operator">+=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">return</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="post-请求"><a class="anchor" href="#post-请求">#</a> POST 请求</h3><p>可以使用 XHR 来模仿表单提交，首先将 Content-Type 头部信息设置为 application/x-www-form-urlencoded，其次以适当的格式创建一个字符串</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// ...</span></pre></td></tr><tr><td data-num="2"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="xmlhttprequest-2-级"><a class="anchor" href="#xmlhttprequest-2-级">#</a> XMLHTTPRequest 2 级</h2><h3 id="formdata"><a class="anchor" href="#formdata">#</a> FormData</h3><p>FormData 为表单序列化以及创建与表单格式相同的数据提供了便利，使用 FormData 的方便之处在于不用给 XHR 对象上设置头部，它能自动识别。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"tony"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="超时设定"><a class="anchor" href="#超时设定">#</a> 超时设定</h3><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// open</span></pre></td></tr><tr><td data-num="2"></td><td><pre>xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Request did not return in ten seconds."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// send</span></pre></td></tr></table></figure><h3 id="overridemimetype方法"><a class="anchor" href="#overridemimetype方法">#</a> overrideMimeType () 方法</h3><p>重写 XHR 响应的 MIME 类型</p><h2 id="进度事件"><a class="anchor" href="#进度事件">#</a> 进度事件</h2><p>Progress Events 规范定义了与客户端服务器通信有关的事件。有六个进度事件：</p><ul><li>loadstart: 在接受到响应数据的第一个字节时触发</li><li>progress: 在接收响应期间持续不断地触发</li><li>error: 在请求发生错误时触发</li><li>abort: 在因为调用 abort () 方法而终止连接时触发</li><li>load: 在接收到完整的响应数据时触发</li><li>loadend: 在通信完成或者触发 error、abort 或 load 事件后触发</li></ul><h3 id="load-事件"><a class="anchor" href="#load-事件">#</a> load 事件</h3><p>用于替代 readystatechange 事件</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>reponseText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="progress-事件"><a class="anchor" href="#progress-事件">#</a> progress 事件</h3><p>这个事件会在浏览器接收新数据期间周期性触发，event 中包含三个属性：</p><ul><li>lengthComputable: 表示进度信息是否可用的布尔值</li><li>position: 表示已经接收到的字节数</li><li>totalSize: 表示根据 Content-Length 响应头部确定的预期字节数</li></ul><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    box<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Received'</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>position <span class="token operator">+</span> <span class="token string">' of '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>totalSize <span class="token operator">+</span> <span class="token string">' bytes'</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="跨域资源共享"><a class="anchor" href="#跨域资源共享">#</a> 跨域资源共享</h2><p>CORS，定义了在必须访问跨域资源时，浏览器与服务器应该如何沟通。在发送请求时，需要给它额外的 Origin 头部，其中包含请求页面的源信息 (协议、域名、端口)，以便服务器根据这个头部信息来决定是否给予响应</p><h3 id="ie-对-cors-的实现"><a class="anchor" href="#ie-对-cors-的实现">#</a> IE 对 CORS 的实现</h3><p><strong>已废弃</strong>，使用 XDomainRequest 实例，简称 XDR</p><h3 id="其他浏览器对-cors-的实现"><a class="anchor" href="#其他浏览器对-cors-的实现">#</a> 其他浏览器对 CORS 的实现</h3><p>在 XHR 对象的 open 方法中传入绝对 URL 即可，但是有以下这些限制：</p><ul><li>不能使用 setRequestHeader () 设置自定义头部</li><li>不能发送和接收 cookie</li><li>调用 getAllResponseHeader () 方法总会返回空字符串</li></ul><h3 id="preflighted-requests"><a class="anchor" href="#preflighted-requests">#</a> Preflighted Requests</h3><blockquote><p>CORS 通过一种叫做 Preflighted Requests 的透明服务器验证机制支持开发人员使用自定义的头部、GET 和 POST 之外的方法，以及不同类型的主体内容。</p></blockquote><p>这是一个 CORS 预检请求是用于检查服务器是否支持 CORS 即跨域资源共享。它一般是用了以下几个 HTTP 请求首部的 OPTIONS 请求：Access-Control-Request-Method 和 Access-Control-Request-Headers，以及一个 Origin 首部。当有必要的时候，浏览器会自动发出一个预检请求；所以在正常情况下，前端开发者不需要自己去发这样的请求。</p><h3 id="带凭据的请求"><a class="anchor" href="#带凭据的请求">#</a> 带凭据的请求</h3><p>默认情况下，跨域请求不能提供凭据 (cookie, HTTP 认证及客户端 SSL 证明等)。通过将 withCredentials 属性设置为 true，可以指定某个请求应该发送凭据。如果浏览器接收带凭据的请求，会用 <code>Access-Control-Allow-Credentials: true</code> HTTP 头部来响应</p><h2 id="其他跨域技术"><a class="anchor" href="#其他跨域技术">#</a> 其他跨域技术</h2><h3 id="图像-ping"><a class="anchor" href="#图像-ping">#</a> 图像 Ping</h3><p>这里通过创建一个 Image 实例，然后将 onload 和 onerror 事件处理程序指定为同一个函数。图像 Ping 常用于跟踪用户点击页面或动态广告曝光次数。图像 Ping 的两个缺点：一个只能发送 GET 请求，二是无法访问服务器的响应文本。因此，图像 Ping 只能用于浏览器与服务器间的单向通信。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>img<span class="token punctuation">.</span>onload <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://www.example.com/api/test?name=tony"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="jsonp"><a class="anchor" href="#jsonp">#</a> JSONP</h3><blockquote><p>JSONP 是通过动态 script 元素来使用的，使用时可以为 src 属性指定一个跨域 URL。这里的 script 域 img 类似，都有能力不受限制地从其他域加载资源。因为 JSONP 是有效的 JS 代码，所以请求完成后，即在 JSONP 响应加载到页面中以后，就会立即执行</p></blockquote><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>ip<span class="token punctuation">,</span> res<span class="token punctuation">.</span>city<span class="token punctuation">,</span> res<span class="token punctuation">.</span>region_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">script</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://freegeoip.net/json/?callback=handleResponse"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>JSONP 优点在于能够直接访问响应文本，支持浏览器与服务器之间的双向通信，但是还有缺点，一是从其他域加载代码，必须保证安全可靠，如果存在恶意代码就会造成破坏，二是确定请求是否失败这一点很不容易。</p><h3 id="comet"><a class="anchor" href="#comet">#</a> Comet</h3><p>两种实现 Comet 的方式：长轮询和流，长轮询是页面发起一个服务器的请求，然后服务器一直保持连接打开，直到有数据可发送。发送完数据之后，随即又发起一个到服务器的新请求，这一过程在页面打开过程中不断进行，可以使用 XHR 和 setTimeout () 实现；流就是浏览器向服务器发送一个请求，而服务器保持连接打开，然后周期性地向浏览器发送数据。</p><h3 id="服务器发送事件"><a class="anchor" href="#服务器发送事件">#</a> [服务器发送事件</h3><p>SSE 服务器围绕只读 Comet 交互推出的 API 或者模式，用于创建到服务器的单向连接，服务器可以通过这个连接发送任意数量的数据。服务器响应的 MIME 类型必须是 text/event-stream。</p><p>EventSource 的实例有一个 readyState 属性，值为 0 正连接到服务器，值 1 表示打开了连接，值 2 代表关闭了连接，还有三个事件：open (建立连接时触发)、message (从服务器接收到新事件时触发)、error (无法建立连接时触发)，响应的格式是纯文本</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">"myevents.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>source<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">const</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>source<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 强制立即断开连接并且不再重新连接</span></pre></td></tr></table></figure><h3 id="web-sockets"><a class="anchor" href="#web-sockets">#</a> Web Sockets</h3><blockquote><p>Web Sockets 的目标是在一个单独的持久连接上提供全双工、双向通信。在 JS 中创建了 Web Socket 之后，会有一个 HTTP 请求发送到浏览器以发起连接。在取得服务器响应后，建立的连接会使用 HTTP 升级从 HTTP 协议交换为 Web Socket 协议。也就是说标准的 HTTPg 服务器无法实现 Web Sockets，只能是支持这种协议的专门服务器才能正常工作。</p></blockquote><p>加密的连接以 wss://，未加密的连接用 ws:// 开头</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"ws://www.example.com/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传入绝对的 URL</span></pre></td></tr></table></figure><p>发送、接收和关闭事件</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只能发送纯文本</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// 当服务器向客户端发送消息时触发 message 事件</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">const</span> data <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// next</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭 socket</span></pre></td></tr></table></figure><p><strong>其他事件</strong></p><ul><li>open: 在成功建立连接时触发</li><li>error: 在发生错误时触发，连接不能持续</li><li>close: 在连接关闭时触发</li></ul><p>WebSocket 对象不支持 DOM2 级事件监听器，也就是说不能用 addEventListener</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 表示连接是否明确的关闭；服务器返回的状态码；包含服务器发回的消息</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>wasClean<span class="token punctuation">,</span> e<span class="token punctuation">.</span>code<span class="token punctuation">,</span> e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/JSON/" rel="tag"><i class="ic i-tag"></i> JSON</a> <a href="/tags/XMLHTTPRequest/" rel="tag"><i class="ic i-tag"></i> XMLHTTPRequest</a> <a href="/tags/AJAX/" rel="tag"><i class="ic i-tag"></i> AJAX</a> <a href="/tags/%E8%B7%A8%E5%9F%9F/" rel="tag"><i class="ic i-tag"></i> 跨域</a> <a href="/tags/Web-Sockets/" rel="tag"><i class="ic i-tag"></i> Web Sockets</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-04-09 17:37:58" itemprop="dateModified" datetime="2022-04-09T17:37:58+08:00">2022-04-09</time> </span><span id="2021/02/15/json与ajax/" class="item leancloud_visitors" data-flag-title="json与ajax" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Seed 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Seed 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Seed 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Seed <i class="ic i-at"><em>@</em></i>越努力越幸运</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/2021/02/15/json%E4%B8%8Eajax/" title="json与ajax">http://example.com/2021/02/15/json与ajax/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/02/09/javascript%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BB%93/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclfw2t96j20zk0m8x6p.jpg" title="javascript事件总结"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> js</span><h3>javascript事件总结</h3></a></div><div class="item right"><a href="/2021/02/16/%E4%BB%A3%E7%A0%81%E5%8E%8B%E7%BC%A9/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclize41wj20zk0m87gk.jpg" title="代码压缩"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> node</span><h3>代码压缩</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json-%E8%AF%AD%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">JSON 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%80%BC"><span class="toc-number">2.1.</span> <span class="toc-text">简单值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.2.</span> <span class="toc-text">对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">2.3.</span> <span class="toc-text">数组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">JSON 解析与序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%89%E9%A1%B9"><span class="toc-number">3.1.</span> <span class="toc-text">序列化选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tojson%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">toJSON () 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E9%80%89%E9%A1%B9"><span class="toc-number">3.3.</span> <span class="toc-text">解析选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xmlhttprequestajax-%E6%8A%80%E6%9C%AF%E7%9A%84%E6%A0%B8%E5%BF%83"><span class="toc-number">4.</span> <span class="toc-text">XMLHTTPRequest (Ajax 技术的核心)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xhr-%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">4.1.</span> <span class="toc-text">xhr 的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">4.2.</span> <span class="toc-text">HTTP 头部信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-%E8%AF%B7%E6%B1%82"><span class="toc-number">4.3.</span> <span class="toc-text">GET 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#post-%E8%AF%B7%E6%B1%82"><span class="toc-number">4.4.</span> <span class="toc-text">POST 请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xmlhttprequest-2-%E7%BA%A7"><span class="toc-number">5.</span> <span class="toc-text">XMLHTTPRequest 2 级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#formdata"><span class="toc-number">5.1.</span> <span class="toc-text">FormData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%85%E6%97%B6%E8%AE%BE%E5%AE%9A"><span class="toc-number">5.2.</span> <span class="toc-text">超时设定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#overridemimetype%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.</span> <span class="toc-text">overrideMimeType () 方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%BA%A6%E4%BA%8B%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">进度事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#load-%E4%BA%8B%E4%BB%B6"><span class="toc-number">6.1.</span> <span class="toc-text">load 事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#progress-%E4%BA%8B%E4%BB%B6"><span class="toc-number">6.2.</span> <span class="toc-text">progress 事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB"><span class="toc-number">7.</span> <span class="toc-text">跨域资源共享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ie-%E5%AF%B9-cors-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.1.</span> <span class="toc-text">IE 对 CORS 的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%B9-cors-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.2.</span> <span class="toc-text">其他浏览器对 CORS 的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preflighted-requests"><span class="toc-number">7.3.</span> <span class="toc-text">Preflighted Requests</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%87%AD%E6%8D%AE%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="toc-number">7.4.</span> <span class="toc-text">带凭据的请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%B7%A8%E5%9F%9F%E6%8A%80%E6%9C%AF"><span class="toc-number">8.</span> <span class="toc-text">其他跨域技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F-ping"><span class="toc-number">8.1.</span> <span class="toc-text">图像 Ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsonp"><span class="toc-number">8.2.</span> <span class="toc-text">JSONP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#comet"><span class="toc-number">8.3.</span> <span class="toc-text">Comet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%91%E9%80%81%E4%BA%8B%E4%BB%B6"><span class="toc-number">8.4.</span> <span class="toc-text">[服务器发送事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-sockets"><span class="toc-number">8.5.</span> <span class="toc-text">Web Sockets</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2020/09/18/%E8%AE%A4%E8%AF%86%E5%87%BD%E6%95%B0/" rel="bookmark" title="认识函数">认识函数</a></li><li><a href="/2020/09/30/use%20strict/" rel="bookmark" title="use strict">use strict</a></li><li><a href="/2020/10/02/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="bookmark" title="正则表达式">正则表达式</a></li><li><a href="/2020/10/10/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%8E%E5%8E%9F%E5%9E%8B/" rel="bookmark" title="构造函数与原型">构造函数与原型</a></li><li><a href="/2020/10/28/%E8%A7%A3%E6%9E%84.%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0.%E5%89%A9%E4%BD%99%E5%8F%82%E6%95%B0.Array%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95.Set/" rel="bookmark" title="解构.箭头函数.剩余参数.Array扩展方法.Set">解构.箭头函数.剩余参数.Array扩展方法.Set</a></li><li><a href="/2020/10/30/typeof%E4%B8%8Einstanceof/" rel="bookmark" title="typeof与instanceof">typeof与instanceof</a></li><li><a href="/2020/10/30/%E9%80%92%E5%BD%92%E5%87%BD%E6%95%B0%E5%8F%8A%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/" rel="bookmark" title="递归函数及深浅拷贝">递归函数及深浅拷贝</a></li><li><a href="/2020/11/09/js%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/" rel="bookmark" title="js字符串常用方法">js字符串常用方法</a></li><li><a href="/2020/11/12/js%E5%B8%B8%E7%94%A8%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95/" rel="bookmark" title="js常用数组方法">js常用数组方法</a></li><li><a href="/2020/11/20/%E9%97%AD%E5%8C%85/" rel="bookmark" title="闭包">闭包</a></li><li><a href="/2020/12/28/canvas%E5%9F%BA%E7%A1%80/" rel="bookmark" title="canvas基础">canvas基础</a></li><li><a href="/2021/01/04/es6%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="es6学习">es6学习</a></li><li><a href="/2021/02/09/javascript%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BB%93/" rel="bookmark" title="javascript事件总结">javascript事件总结</a></li><li class="active"><a href="/2021/02/15/json%E4%B8%8Eajax/" rel="bookmark" title="json与ajax">json与ajax</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Seed" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Seed</p><div class="description" itemprop="description">学海无涯</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">30</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">7</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">28</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>友链</a></li><li class="item"><a href="/books/" rel="section"><i class="ic i-heart"></i>书架</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/02/09/javascript%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BB%93/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/02/16/%E4%BB%A3%E7%A0%81%E5%8E%8B%E7%BC%A9/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%89%8D%E7%AB%AF/" title="分类于 前端">前端</a></div><span><a href="/2020/12/05/VSCode%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" title="VSCode常用快捷键">VSCode常用快捷键</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/js/" title="分类于 js">js</a></div><span><a href="/2020/12/28/canvas%E5%9F%BA%E7%A1%80/" title="canvas基础">canvas基础</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue/" title="分类于 vue">vue</a></div><span><a href="/2021/05/12/vue%E9%80%80%E5%87%BA%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85/" title="vue退出组件封装">vue退出组件封装</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/css/" title="分类于 css">css</a></div><span><a href="/2020/10/25/CSS%E5%B8%83%E5%B1%80/" title="CSS布局">CSS布局</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/css/" title="分类于 css">css</a></div><span><a href="/2020/10/17/css%E9%80%89%E6%8B%A9%E5%99%A8/" title="css选择器">css选择器</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/js/" title="分类于 js">js</a></div><span><a href="/2020/10/28/%E8%A7%A3%E6%9E%84.%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0.%E5%89%A9%E4%BD%99%E5%8F%82%E6%95%B0.Array%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95.Set/" title="解构.箭头函数.剩余参数.Array扩展方法.Set">解构.箭头函数.剩余参数.Array扩展方法.Set</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/node/" title="分类于 node">node</a></div><span><a href="/2021/02/16/%E4%BB%A3%E7%A0%81%E5%8E%8B%E7%BC%A9/" title="代码压缩">代码压缩</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue/" title="分类于 vue">vue</a></div><span><a href="/2021/05/13/vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" title="vue生命周期">vue生命周期</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/js/" title="分类于 js">js</a></div><span><a href="/2021/02/15/json%E4%B8%8Eajax/" title="json与ajax">json与ajax</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/js/" title="分类于 js">js</a></div><span><a href="/2021/02/09/javascript%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BB%93/" title="javascript事件总结">javascript事件总结</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Seed @ Seed's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">135k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:03</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/02/15/json与ajax/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->